language: go
sudo: required
services:
- docker
go:
- 1.6
before_install:
- openssl aes-256-cbc -K $encrypted_790acdb9ad25_key -iv $encrypted_790acdb9ad25_iv
  -in catalogue_deploy_rsa.enc -out catalogue_deploy_rsa -d
- go get golang.org/x/tools/cmd/cover
- go get github.com/mattn/goveralls
- go get github.com/gorilla/mux
- go get github.com/go-kit/kit/log
- go get github.com/go-kit/kit/endpoint
- go get github.com/go-kit/kit/transport/http
- go get github.com/go-kit/kit/metrics/prometheus
- go get github.com/prometheus/client_golang/prometheus
- go get github.com/go-sql-driver/mysql
- go get github.com/jmoiron/sqlx
- go get gopkg.in/DATA-DOG/go-sqlmock.v1
install: true
env:
- GROUP=weaveworksdemos COMMIT=$TRAVIS_COMMIT TAG=$TRAVIS_TAG REPO=catalogue;
script:
- set -e
- "./scripts/build.sh;"
- "./test/test.sh unit.py"
- "./test/test.sh container.py --tag $TAG"
after_success:
- set -e;
- if [ -z "$DOCKER_PASS" ] ; then echo "This is a build triggered by an external PR.
  Skipping docker push."; exit 0; fi;
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS;
- "./scripts/push.sh"
before_deploy:
- eval "$(ssh-agent -s)"
- chmod 600 $TRAVIS_BUILD_DIR/${REPO}_deploy_rsa
- ssh-add $TRAVIS_BUILD_DIR/${REPO}_deploy_rsa
addons:
  ssh_known_hosts: "$BASTION"
deploy:
  provider: script
  skip_cleanup: true
  script: ssh -o StrictHostKeyChecking=no $BASTION_USER@$BASTION ./deploy.sh ${REPO}
    $COMMIT
  on:
    branch: master
notifications:
  slack:
    secure: uwlcWCyyEW0xssAi6pNIzMtw5r5Zak07+b34sR8uiyCnxrFHPypa7/spV0dn7KHDjcDM+A5J+fCQQ2nvQ0EoDOoGndaDmtOYpgDSG17DdXB1uk3P3dADyuhLMFl9U7TYpxGVDvCoEPx9r2s/1ACEWq8QWpxt7oDVTWNCcMiO/XUoQgHoP7mu573xAOK2OE2cu62R412ycz0TNY295SOsTPoze+cfVCfg+RfQoo9l0UDZK2OClYS6DNFoyG2OGhh4mVB8tjzmzwRDbgrNXrBU5HuP2h9Nk04u8284wuBVg0C4oTiRIzpDTNmowdq0T24uE/RZMwNIgnYt1d+djzlGPB97lGTIFQvQKP9u/D7JtWnjpHvrKbn2TC/dJTF5nCiai4D8WKwDc4Kl/a0ALJiUM2NUd3vmK0O1sWwu4UqMEbMB3Vj9Gq2UylnS1k2TaNmkI4hfLCL3brqTMicULLubIfA5HZSEegvAwly/kPQpfi6AJ7/vedWLnCGr3VnuWwMAYntru/3fKbYBMUJMEkT9XqQiblqsArjUDz8l2CyhVT34q/ZIiYR83EAX6mDkk2mBgp7DiT3VKMQ1dyGtLa1AjtbUphWRNyOM/j2ZX9aTBozNV7iAvDDujMQurTmjZshO/WO5qSOs4F57lYSQpu26Wx5vyPa4oY2chsZLK+rVdDU=

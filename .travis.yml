language: go
sudo: required
services:
  - docker
go:
  - 1.6
before_install:
  - go get golang.org/x/tools/cmd/cover
  - go get github.com/mattn/goveralls
  - go get github.com/gorilla/mux 
  - go get github.com/go-kit/kit/log 
  - go get github.com/go-kit/kit/endpoint 
  - go get github.com/go-kit/kit/transport/http 
  - go get github.com/go-sql-driver/mysql 
  - go get github.com/jmoiron/sqlx
  - go get gopkg.in/DATA-DOG/go-sqlmock.v1

install: true

env:
  - GROUP=weaveworksdemos COMMIT=$TRAVIS_COMMIT TAG=$TRAVIS_TAG;

script:
  - set -e
  - ./scripts/build.sh;
  - ./test/test.sh unit.py
#  - ./test/test.sh component.py
#  - ./test/test.sh container.py --tag $TAG

after_success:
  - set -e;
  # - $HOME/gopath/bin/goveralls -service=travis-ci
  - if [ -z "$DOCKER_PASS" ] ; then
      echo "This is a build triggered by an external PR. Skipping docker push.";
      exit 0;
    fi;
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS;
  - ./scripts/push.sh